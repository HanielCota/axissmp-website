```markdown
# ğŸ“œ REGRAS DE DESENVOLVIMENTO â€” PADRÃƒO SÃŠNIOR INEGOCIÃVEL

**Next.js (App Router) + Supabase + Tailwind CSS + TypeScript**

> **Este documento define regras ABSOLUTAS para todo cÃ³digo entregue.**  
> NÃ£o hÃ¡ exceÃ§Ãµes implÃ­citas. Em caso de dÃºvida, prefira o caminho mais **explÃ­cito, previsÃ­vel e seguro**.

---

## ğŸš€ 1. FONTES DE VERDADE (HIERARQUIA ABSOLUTA)

| Prioridade | Fonte | ReferÃªncia |
|------------|-------|------------|
| **1Âª** | DocumentaÃ§Ã£o oficial (mais recente) | [Next.js](https://nextjs.org/docs/app), [Supabase SSR](https://supabase.com/docs/guides/auth/server-side) |
| **2Âª** | Este documento | RULES.md |
| **3Âª** | Conhecimento prÃ©vio | - |

**Conflito? DocumentaÃ§Ã£o oficial SEMPRE vence.**

---

## ğŸ§  2. CLEAN CODE â€” ZERO TOLERÃ‚NCIA

### 2.1 Fluxo de Controle **OBRIGATÃ“RIO**
```typescript
// âœ… CORRETO - Early Return
export function processUser(user: User | null) {
  if (!user) return null;
  if (!user.email) throw new Error('Email obrigatÃ³rio');
  
  // Happy path no nÃ­vel raiz
  return transformUser(user);
}

// âŒ PROIBIDO - else e aninhamento
```

- **Early Return**: obrigatÃ³rio em todo `if`
- **else**: **PROIBIDO** em qualquer lugar
- **Fluxo principal**: sempre no nÃ­vel raiz da funÃ§Ã£o

### 2.2 Estrutura Visual **OBRIGATÃ“RIA**
```typescript
export async function createProfile(data: CreateProfileInput) {
  // 1. VALIDAÃ‡Ã•ES (Early Returns)
  validateProfileData(data);
  
  // 2. LÃ“GICA PRINCIPAL (espaÃ§amento intencional)
  
  const result = await supabase.from('profiles').insert(data);
  
  // 3. RETORNO
  return result;
}
```

### 2.3 FormataÃ§Ã£o **AUTOMÃTICA**
- Prettier + ESLint = **lei**
- CÃ³digo entregue **nunca** precisa de ajustes
- Imports ordenados, quebras consistentes

---

## ğŸ—ï¸ 3. ARQUITETURA NEXT.JS (APP ROUTER)

### 3.1 Server First **PADRÃƒO ABSOLUTO**
```typescript
// âœ… Server Component (padrÃ£o)
export default async function Page() {
  const data = await fetchData(); // Server-side
  return <ProfileList data={data} />;
}

// âŒ Client Component (exceÃ§Ã£o)
'use client'; // Somente se hook/evento browser necessÃ¡rio
```

**Client Components**: `'use client'` APENAS para:
- Hooks de estado/efeito
- Eventos do browser (onClick, onChange)

### 3.2 Server Actions **FORMATO OBRIGATÃ“RIO**
```typescript
'use server';

import { z } from 'zod';

const schema = z.object({ name: z.string().min(1) });

export async function createProfile(prevState: any, formData: FormData) {
  const validated = schema.safeParse(Object.fromEntries(formData));
  if (!validated.success) {
    return { data: null, error: validated.error.message };
  }

  const { data, error } = await supabase.from('profiles').insert(validated.data);
  if (error) return { data: null, error: error.message };

  revalidatePath('/dashboard');
  return { data: data[0], error: null };
}
```

**Retorno SEMPRE**:
```typescript
{ data: T | null; error: string | null }
```

### 3.3 UX Loading **OBRIGATÃ“RIO**
```
app/dashboard/
â”œâ”€â”€ page.tsx
â”œâ”€â”€ loading.tsx  â† Skeleton obrigatÃ³rio
â””â”€â”€ error.tsx
```

---

## â˜ï¸ 4. SUPABASE & SEGURANÃ‡A

### 4.1 InstanciaÃ§Ã£o **ÃšNICA**
```typescript
// Server
import { createSupabaseServerClient } from '@/utils/supabase/server';

// Client  
import { createSupabaseClient } from '@/utils/supabase/client';
```

**Nunca** instanciar Supabase diretamente.

### 4.2 RLS **SAGRADO**
```
âœ… RLS ativado + validaÃ§Ã£o Zod
âŒ "RLS segura tudo"
```

### 4.3 Middleware **OBRIGATÃ“RIO**
```typescript
// app/middleware.ts - ProteÃ§Ã£o de rotas
export const config = {
  matcher: ['/dashboard/:path*']
};
```

### 4.4 ValidaÃ§Ã£o **ZOD OBRIGATÃ“RIO**
```typescript
const paramsSchema = z.object({
  id: z.string().uuid()
});

const validated = paramsSchema.parse(params);
```

**Validar SEMPRE**:
- `params`
- `searchParams` 
- `formData`
- Corpo de requests

---

## ğŸ¨ 5. TAILWIND CSS â€” ESTILIZAÃ‡ÃƒO

### 5.1 Classes **SEMÃ‚NTICAS**
```typescript
// âœ… CORRETO - agrupadas logicamente
<div className="
  container mx-auto
  p-6
  bg-white rounded-lg
  shadow-lg
">
```

### 5.2 Condicionais **cn() OBRIGATÃ“RIO**
```typescript
import { cn } from '@/lib/utils';

<div className={cn(
  'btn',
  isLoading && 'opacity-50 cursor-not-allowed'
)}>
```

### 5.3 DuplicaÃ§Ã£o **PROIBIDA**
```
Se repetir 2+ vezes â†’ criar componente UI
```

---

## âŒ¨ï¸ 6. TYPESCRIPT â€” ZERO ANY

### 6.1 Tipos **EXPLÃCITOS**
```typescript
// âœ… CORRETO
interface Props {
  profiles: Profile[];
  onDelete: (id: string) => void;
}

// âŒ PROIBIDO
function Component(props: any) { }
```

### 6.2 Supabase Types **GERADOS**
```bash
npx supabase gen types typescript --local > types/supabase.ts
```

---

## ğŸ”’ 7. PROTOCOLO DE EXECUÃ‡ÃƒO (CHECKLIST)

### Antes de escrever **TODO** cÃ³digo:

```mermaid
graph TD
  A[1. Verificar: else? Aninhamento?] --> B[2. Validar: Server ou Client?]
  B --> C[3. Zod schema pronto?]
  C --> D[4. Retorno padronizado?]
  D --> E[ESCREVER]
```

### RefatoraÃ§Ã£o **PRIORITÃRIA** para cÃ³digo legado:
1. `if/else` aninhado
2. FunÃ§Ãµes > 30 linhas  
3. MÃºltiplas responsabilidades

---

## âœ… CHECKLIST FINAL (CÃ“DIGO PRONTO?)

| Item | âœ… |
|------|---|
| Early return em todos `if`? | â˜ |
| Zero `else`? | â˜ |
| Server Component (quando possÃ­vel)? | â˜ |
| Server Action com Zod? | â˜ |
| `loading.tsx` com skeleton? | â˜ |
| Tipos explÃ­citos (zero `any`)? | â˜ |
| Classes Tailwind agrupadas? | â˜ |
| RLS + validaÃ§Ã£o Zod? | â˜ |
| Middleware protegendo rotas? | â˜ |

---

## ğŸ’ PRINCÃPIO FINAL

```
CÃ³digo bom = funciona
CÃ³digo sÃªnior = ensina, escala, nÃ£o surpreende
```
